(function(e){"use strict";var n=this,t=n.SpeechRecognition||n.webkitSpeechRecognition||n.mozSpeechRecognition||n.msSpeechRecognition||n.oSpeechRecognition;if(!t)return n.annyang=null,e;var o,r,a=[],c={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},i=0,s=!1,l="font-weight: bold; color: #00f;",u=!1,g=/\s*\((.*?)\)\s*/g,f=/(\(\?:[^)]+\))\?/g,h=/(\(\?)?:\w+/g,m=/\*\w+/g,p=/[\-{}\[\]+?.,\\\^$|#]/g,d=function(e){return e=e.replace(p,"\\$&").replace(g,"(?:$1)?").replace(h,function(e,n){return n?e:"([^\\s]+)"}).replace(m,"(.*?)").replace(f,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i")},y=function(e){var n=Array.prototype.slice.call(arguments,1);e.forEach(function(e){e.callback.apply(e.context,n)})},v=function(){w()||n.annyang.init({},!1)},w=function(){return o!==e},b=function(e,t,o){a.push({command:e,callback:t,originalPhrase:o}),s&&n.console.log("Command successfully loaded: %c"+o,l)};n.annyang={init:function(g,f){f=f===e?!0:!!f,o&&o.abort&&o.abort(),o=new t,o.maxAlternatives=5,o.continuous="http:"===n.location.protocol,o.lang="en-US",o.onstart=function(){y(c.start)},o.onerror=function(e){switch(y(c.error),e.error){case"network":y(c.errorNetwork);break;case"not-allowed":case"service-not-allowed":r=!1,y((new Date).getTime()-i<200?c.errorPermissionBlocked:c.errorPermissionDenied)}},o.onend=function(){if(y(c.end),r){var e=(new Date).getTime()-i;1e3>e?setTimeout(n.annyang.start,1e3-e):n.annyang.start()}},o.onresult=function(e){if(u)return s&&n.console.log("Speech heard, but annyang is paused"),!1;for(var t=e.results[e.resultIndex],o=[],r=0;r<t.length;r++)o[r]=t[r].transcript;y(c.result,o);for(var i,g=0;g<o.length;g++){i=o[g].trim(),s&&n.console.log("Speech recognized: %c"+i,l);for(var f=0,h=a.length;h>f;f++){var m=a[f].command.exec(i);if(m){var p=m.slice(1);return s&&(n.console.log("command matched: %c"+a[f].originalPhrase,l),p.length&&n.console.log("with parameters",p)),a[f].callback.apply(this,p),y(c.resultMatch,i,a[f].originalPhrase,o),!0}}}return y(c.resultNoMatch,o),!1},f&&(a=[]),g.length&&this.addCommands(g)},start:function(t){u=!1,v(),t=t||{},r=t.autoRestart!==e?!!t.autoRestart:!0,t.continuous!==e&&(o.continuous=!!t.continuous),i=(new Date).getTime();try{o.start()}catch(a){s&&n.console.log(a.message)}},abort:function(){r=!1,w&&o.abort()},pause:function(){u=!0},resume:function(){n.annyang.start()},debug:function(e){s=arguments.length>0?!!e:!0},setLanguage:function(e){v(),o.lang=e},addCommands:function(e){var t;v();for(var o in e)if(e.hasOwnProperty(o))if(t=n[e[o]]||e[o],"function"==typeof t)b(d(o),t,o);else{if(!("object"==typeof t&&t.regexp instanceof RegExp)){s&&n.console.log("Can not register command: %c"+o,l);continue}b(new RegExp(t.regexp.source,"i"),t.callback,o)}},removeCommands:function(n){return n===e?void(a=[]):(n=Array.isArray(n)?n:[n],void(a=a.filter(function(e){for(var t=0;t<n.length;t++)if(n[t]===e.originalPhrase)return!1;return!0})))},addCallback:function(t,o,r){if(c[t]!==e){var a=n[o]||o;"function"==typeof a&&c[t].push({callback:a,context:r||this})}}}}).call(this);