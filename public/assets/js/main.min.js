(function(n){"use strict";var e=this,o=e.SpeechRecognition||e.webkitSpeechRecognition||e.mozSpeechRecognition||e.msSpeechRecognition||e.oSpeechRecognition;if(!o)return e.annyang=null,n;var t,r,a=[],c={start:[],error:[],end:[],result:[],resultMatch:[],resultNoMatch:[],errorNetwork:[],errorPermissionBlocked:[],errorPermissionDenied:[]},i=0,s=!1,l="font-weight: bold; color: #00f;",u=!1,g=/\s*\((.*?)\)\s*/g,f=/(\(\?:[^)]+\))\?/g,m=/(\(\?)?:\w+/g,d=/\*\w+/g,h=/[\-{}\[\]+?.,\\\^$|#]/g,p=function(n){return n=n.replace(h,"\\$&").replace(g,"(?:$1)?").replace(m,function(n,e){return e?n:"([^\\s]+)"}).replace(d,"(.*?)").replace(f,"\\s*$1?\\s*"),new RegExp("^"+n+"$","i")},y=function(n){var e=Array.prototype.slice.call(arguments,1);n.forEach(function(n){n.callback.apply(n.context,e)})},v=function(){w()||e.annyang.init({},!1)},w=function(){return t!==n},b=function(n,o,t){a.push({command:n,callback:o,originalPhrase:t}),s&&e.console.log("Command successfully loaded: %c"+t,l)};e.annyang={init:function(g,f){f=f===n?!0:!!f,t&&t.abort&&t.abort(),t=new o,t.maxAlternatives=5,t.continuous="http:"===e.location.protocol,t.lang="en-US",t.onstart=function(){y(c.start)},t.onerror=function(n){switch(y(c.error),n.error){case"network":y(c.errorNetwork);break;case"not-allowed":case"service-not-allowed":r=!1,y((new Date).getTime()-i<200?c.errorPermissionBlocked:c.errorPermissionDenied)}},t.onend=function(){if(y(c.end),r){var n=(new Date).getTime()-i;1e3>n?setTimeout(e.annyang.start,1e3-n):e.annyang.start()}},t.onresult=function(n){if(u)return s&&e.console.log("Speech heard, but annyang is paused"),!1;for(var o=n.results[n.resultIndex],t=[],r=0;r<o.length;r++)t[r]=o[r].transcript;y(c.result,t);for(var i,g=0;g<t.length;g++){i=t[g].trim(),s&&e.console.log("Speech recognized: %c"+i,l);for(var f=0,m=a.length;m>f;f++){var d=a[f].command.exec(i);if(d){var h=d.slice(1);return s&&(e.console.log("command matched: %c"+a[f].originalPhrase,l),h.length&&e.console.log("with parameters",h)),a[f].callback.apply(this,h),y(c.resultMatch,i,a[f].originalPhrase,t),!0}}}return y(c.resultNoMatch,t),!1},f&&(a=[]),g.length&&this.addCommands(g)},start:function(o){u=!1,v(),o=o||{},r=o.autoRestart!==n?!!o.autoRestart:!0,o.continuous!==n&&(t.continuous=!!o.continuous),i=(new Date).getTime();try{t.start()}catch(a){s&&e.console.log(a.message)}},abort:function(){r=!1,w&&t.abort()},pause:function(){u=!0},resume:function(){e.annyang.start()},debug:function(n){s=arguments.length>0?!!n:!0},setLanguage:function(n){v(),t.lang=n},addCommands:function(n){var o;v();for(var t in n)if(n.hasOwnProperty(t))if(o=e[n[t]]||n[t],"function"==typeof o)b(p(t),o,t);else{if(!("object"==typeof o&&o.regexp instanceof RegExp)){s&&e.console.log("Can not register command: %c"+t,l);continue}b(new RegExp(o.regexp.source,"i"),o.callback,t)}},removeCommands:function(e){return e===n?void(a=[]):(e=Array.isArray(e)?e:[e],void(a=a.filter(function(n){for(var o=0;o<e.length;o++)if(e[o]===n.originalPhrase)return!1;return!0})))},addCallback:function(o,t,r){if(c[o]!==n){var a=e[t]||t;"function"==typeof a&&c[o].push({callback:a,context:r||this})}}}}).call(this);var commands={hello:function(){alert("Hello world!")}};annyang.addCommands(commands),annyang.start();